const path=require('path');
const authenticate=(req,res,next)=>{
    if(req.session.Login){
        console.log(req.session.Login)
        next ();
    }
    else{
        res.redirect('/Login');
    }
}

const {profile}=require(path.join(__dirname,'..','Model','profile.model.js'));

const {register}=require(path.join(__dirname,'..','Model','userDetails.model.js'));

function getUserDashboard(req,res){
    register.findOne({autoGeneratedUserName:req.session.userIdentification},function(errors,outcome){
        if(errors){

        }
        else{
            if(outcome){
                profile.findOne({userId:outcome._id},function(error,result){
                    if(result){
                    if(result.path){
                        console.log(`the actual:${result} & ${result.path}`)
                        res.render('User_dashboard',{userName:req.session.userIdentification,result})
                    }
                    else if(!result.path){
                        result.path="./images/i11.png";
                        console.log(result);
                       console.log(`the result is:${result} & ${result.path}`)
                       res.render('User_dashboard',{userName:req.session.userIdentification,result})
                   }
                    }
                    else if(!result){
                        result={
                           path: "./images/i11.png"
                        };
                        console.log(`formed :${result.path}`)
                    res.render('User_dashboard',{userName:req.session.userIdentification,result})
            
                    }
                })
        
            }
        }

    })
   
        
        // console.log(result);

    
}
module.exports={
    getUserDashboard,
    authenticate,
}